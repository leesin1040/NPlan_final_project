<!doctype html>
<html lang="en">
  <head>
    <%-include('../partials/head.ejs') %>
  </head>
  <body>
    <%-include('../partials/header.ejs') %>
    <div class="container" style="width: 900px;">
      <!-- ë³¸ë¬¸ -->
      <div class="row my-4">
        <div class="col-md-6">
          <h5>ê²€ìƒ‰ì–´ ğŸ” &ensp; "<%= searchedWord %>"</h5>
          <!-- <p><a href="">ì¸ê¸°ìˆœ</a> / <a href="">ìµœì‹ ìˆœ</a></p> -->
        </div>
        <% if(user===null){ %>
          <div class="col-md-6 text-end">
            <p class="tex-sm">ë¡œê·¸ì¸ í›„ ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          </div>
          <% }else{ %>
            <div class="col-md-6 text-end">
              <button type="button" onclick="location.href='/post'" class="btn btn-outline-secondary"><i class="fa-solid fa-pen me-2"></i>ê¸€ì“°ê¸°</button>
            </div>
            <% } %>
      </div>
      <div class="row">
        <h5>ì œëª© ê²€ìƒ‰</h5>
        <!-- ì—¬í–‰ í¬ìŠ¤íŠ¸ ì¹´ë“œ ë°˜ë³µë¬¸-->
        <% searchByTitle.forEach(function(articleOne) { %>
          <div class="my-1">
            <a href="/article/<%= articleOne.id %>" class="card-link">
              <div class="searchedResult">
                <div class="d-flex justify-content-between align-items-center">
                  <span class="text-muted small"><%= articleOne.id %></span>
                  <h5 class="card-title mb-0"><%= articleOne.title %></h5>
                  <span class="text-muted small">ì‘ì„±ì: <%= articleOne.writer %></span>
                </div>
              </div>
            </a>
          </div>
        <% }); %>
        <h5 class="mt-5">ë‚´ìš© ê²€ìƒ‰</h5>
        <% searchByContent.forEach(function(articleOne, index) { %>
          <div class="my-1">
            <a href="/article/<%= articleOne.id %>">
              <div class="searchedResult">
                <div class="d-flex justify-content-between align-items-center">
                  <span class="text-muted small"><%= articleOne.id %></span>
                  <h5 class="card-title mb-0"><%= articleOne.title %></h5>
                  <span class="text-muted small">ì‘ì„±ì: <%= articleOne.writer %></span>
                </div>
                <p class="article-content small mt-4 text-center"><%= articleOne.content %></p>
              </div>
            </a>
          </div>
        <% }); %>
        
        <!-- ì—¬í–‰ í¬ìŠ¤íŠ¸ ì¹´ë“œ ë -->
      </div>
      <!-- ë³¸ë¬¸ -->
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const searchText = "<%= searchedWord %>";
        const snippetLength = 100; // í•˜ì´ë¼ì´íŒ…ëœ í…ìŠ¤íŠ¸ ì£¼ë³€ìœ¼ë¡œ í¬í•¨í•  ë¬¸ìì—´ì˜ ê¸¸ì´
    
        if(searchText) {
          const contents = document.querySelectorAll(".article-content");
    
          contents.forEach(content => {
            const originalText = content.textContent || content.innerText;
            const lowerOriginalText = originalText.toLowerCase();
            const searchTextLower = searchText.toLowerCase();
    
            // ê²€ìƒ‰ì–´ ìœ„ì¹˜ ì°¾ê¸°
            const index = lowerOriginalText.indexOf(searchTextLower);
    
            if(index !== -1) {
              // ê²€ìƒ‰ì–´ ì£¼ë³€ì˜ í…ìŠ¤íŠ¸ ì¶”ì¶œ
              let start = index - snippetLength / 2;
              let end = index + searchTextLower.length + snippetLength / 2;
              start = start < 0 ? 0 : start;
              end = end > originalText.length ? originalText.length : end;
    
              // í•˜ì´ë¼ì´íŒ…ëœ í…ìŠ¤íŠ¸ì™€ ì£¼ë³€ í…ìŠ¤íŠ¸ ì¶”ì¶œ
              let snippet = originalText.slice(start, end);
              if (start > 0) snippet = "..." + snippet;
              if (end < originalText.length) snippet += "...";
    
              // ê²€ìƒ‰ì–´ í•˜ì´ë¼ì´íŒ…
              snippet = snippet.replace(new RegExp(searchText, "gi"), `<span style="color:red;">${searchText}</span>`);
    
              // ë‚´ìš© ì—…ë°ì´íŠ¸
              content.innerHTML = snippet;
            }
          });
        }
      });
    </script>
    
    <%-include('../partials/script.ejs') %>
  </body>
</html>
