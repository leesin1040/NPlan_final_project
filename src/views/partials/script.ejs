<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
  crossorigin="anonymous"
></script>
<script defer src="https://npmcdn.com/flatpickr/dist/flatpickr.min.js"></script>
<script defer src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="./script/main.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // header.html 로드 후 로그아웃 버튼 설정
    const logoutButton = document.getElementById('logoutButton');
    if (logoutButton) {
      logoutButton.addEventListener('click', function () {
        localStorage.removeItem('accessToken'); // JWT 토큰 제거
        window.location.href = '/home'; // 메인 페이지로 리디렉션
      });
    }
    // 로그인 여부에 따른 버튼 표기
    const accessToken = localStorage.getItem('accessToken');
    const BeforeLoginButton = document.getElementById('BeforeLoginButton');
    const beforeLoginSignupBtn = document.getElementById('beforeLoginSignupBtn');
    const userExist = document.getElementById('userExist');
    if ((beforeLoginSignupBtn, BeforeLoginButton && userExist)) {
      if (accessToken) {
        BeforeLoginButton.style.display = 'none';
        beforeLoginSignupBtn.style.display = 'none';
        userExist.style.display = 'block';
      } else {
        BeforeLoginButton.style.display = 'block';
        beforeLoginSignupBtn.style.display = 'block';
        userExist.style.display = 'none';
      }
    }
    // 로그인 엑시오스 불러오기
    const realLoginBtn = document.getElementById('realLoginBtn');
    realLoginBtn.addEventListener('click', handleLogin);

    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');
    if (startDateInput && endDateInput) {
      flatpickr(startDateInput, {
        position: 'above',
        minDate: 'today',
        dateFormat: 'Y-m-d',
        locale: 'ko',
      });
      flatpickr(endDateInput, {
        position: 'above',
        minDate: 'today',
        dateFormat: 'Y-m-d',
        locale: 'ko',
      });
    }
  });

  // 로그인 엑시오스
  function handleLogin(event) {
    event.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    if (!email || !password) {
      alert('이메일과 비밀번호를 입력해주세요.');
      return;
    }
    console.log('로그인 엑시오스');
    try {
      let response = axios
        .post('api/auth/login', { email, password })
        .then((response) => {
          console.log(response.data.accessToken);
          console.log(response.data.data);
          const { accessToken } = response.data.data.accessToken;
          localStorage.setItem('accessToken', accessToken);
          alert('로그인 되었습니다');
          location.href = '/home';
        })
        .catch((error) => {
          alert(error.response.data.message);
        });
    } catch (err) {
      alert(err);
    }
  }
</script>
