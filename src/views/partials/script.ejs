<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
  crossorigin="anonymous"
></script>
<script defer src="https://npmcdn.com/flatpickr/dist/flatpickr.min.js"></script>
<script defer src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="/script/main.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // header.html 로드 후 로그아웃 버튼 설정
    const logoutButton = document.getElementById('logoutButton');
    if (logoutButton) {
      logoutButton.addEventListener('click', () => {
        const cookieName = 'Authorization';
        const deleteCookie = (name) => {
          document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
        };
        localStorage.removeItem('Authorization'); // 로컬 스토리지에서 엑세스 토큰 제거
        deleteCookie(cookieName); // 쿠키에서 엑세스 토큰 삭제
        window.location.href = '/home'; // 메인 페이지로 리디렉션
      });
    }
    // 로그인 엑시오스 불러오기
    const realLoginBtn = document.getElementById('realLoginBtn');
    realLoginBtn.addEventListener('click', handleLogin);
    // 테마 선택
    const themeBoxes = document.querySelectorAll('.theme-box');
    themeBoxes.forEach((box) => {
      box.addEventListener('click', function () {
        const selectedTheme = this.getAttribute('data-theme');
        document.getElementById('selectedTheme').value = selectedTheme;
        themeBoxes.forEach((box) => box.classList.remove('selected'));
        this.classList.add('selected');
      });
    });
    // 지역 선택
    const regionBoxes = document.querySelectorAll('.region-box');
    regionBoxes.forEach((box) => {
      box.addEventListener('click', function () {
        const selectedRegion = this.getAttribute('data-region');
        document.getElementById('selectedRegion').value = selectedRegion;
        regionBoxes.forEach((box) => box.classList.remove('selected'));
        this.classList.add('selected');
      });
    });
    // 컬러 박스 선택
    document.querySelectorAll('.color-box').forEach((box) => {
      box.addEventListener('click', function () {
        document.querySelectorAll('.color-box').forEach((b) => b.classList.remove('selected'));
        this.classList.add('selected');
        document.getElementById('selectedColor').value = this.getAttribute('data-color');
      });
    });
    //날짜
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');
    if (startDateInput && endDateInput) {
      flatpickr(startDateInput, {
        position: 'above',
        minDate: 'today',
        dateFormat: 'Y-m-d',
        locale: 'ko',
      });
      flatpickr(endDateInput, {
        position: 'above',
        minDate: 'today',
        dateFormat: 'Y-m-d',
        locale: 'ko',
      });
    }
  });

  // 로그인 엑시오스
  function handleLogin(event) {
    event.preventDefault();
    const loginEmail = document.getElementById('loginEmail').value;
    const loginPassword = document.getElementById('loginPassword').value;
    if (!loginEmail || !loginPassword) {
      alert('이메일과 비밀번호를 입력해주세요.');
      return;
    }
    console.log('로그인 엑시오스');
    try {
      let response = axios
        .post('api/auth/login', { email: loginEmail, password: loginPassword })
        .then((response) => {
          console.log(response.data.accessToken);
          console.log(response.data.data);
          const { accessToken } = response.data.data.accessToken;
          localStorage.setItem('accessToken', accessToken);
          alert('로그인 되었습니다');
          location.href = '/home';
        })
        .catch((error) => {
          alert(error.response.data.message);
        });
    } catch (err) {
      alert(err);
    }
  }
</script>
